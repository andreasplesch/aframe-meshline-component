!function(t){function e(r){if(i[r])return i[r].exports;var s=i[r]={exports:{},id:r,loaded:!1};return t[r].call(s.exports,s,s.exports,e),s.loaded=!0,s.exports}var i={};return e.m=t,e.c=i,e.p="",e(0)}([function(t,e,i){function r(t){t=t.replace(/\,/g," "),t=t.replace(/\-/g," -"),t=t.replace(/[A-z]/g," $& "),t=t.replace(/\s+/g," ").trim();var e=[];return t.split(" ").forEach(function(t,i){if(isFinite(t))e.push(1*t);else if(/[mlhvcsqtaz]/gi.exec(t))e.push(t);else if(t.split(".").length>2){var r=t.split("."),s=r[0].length+1+r[1].length/2;e.push(1*t.substring(0,s)),e.push(1*t.substring(s))}}),e}function s(t,e){for(var i,r,s,o,n,a=new THREE.Geometry,h=new THREE.Vector3(0,0,0),u=null,c=0,l=0;l<t.length;l++)isFinite(t[l])||t[l].search(/[mlhvcsqtaz]/i)>=0||console.warn("Invalid item in tokenized SVG string: tok["+l+"]="+t[l]+"\nComplete string:\n"+t.join(" "));for(var l=0;l<t.length;l++)if(!isFinite(t[l])){for(var p=l,d=l+1;d<t.length;d++)if(!isFinite(t[d])){p=d;break}if(p==l&&(p=t.length),"M"==t[l]&&(h=new THREE.Vector3(t[l+1],t[l+2],0),a.vertices.push(h.clone()),l>0&&console.warn("SVG path contains M commands after the first command. This is not yet supported and these M commands will be drawn as lines.")),"L"==t[l]){c=(p-l-1)/2,console.assert(c==Math.floor(c)),l+=1;for(var i=0;i<c;i++)h=new THREE.Vector3(t[l],t[l+1],0),a.vertices.push(h.clone()),l+=2}if("l"==t[l]){c=(p-l-1)/2,console.assert(c==Math.floor(c)),l+=1;for(var i=0;i<c;i++)h=new THREE.Vector3(t[l],t[l+1],0),a.vertices.push(h.clone().add(h)),l+=2}if("H"==t[l]&&(h=new THREE.Vector3(t[l+1],h.y,0),a.vertices.push(h.clone())),"h"==t[l]&&(h=new THREE.Vector3(t[l+1],h.y,0).add(h),a.vertices.push(h.clone())),"V"==t[l]&&(h=new THREE.Vector3(h.x,t[l+1],0),a.vertices.push(h.clone())),"v"==t[l]&&(h=new THREE.Vector3(h.x,t[l+1],0).add(h),a.vertices.push(h.clone())),"A"==t[l]&&console.error("SVG arcs (A) not supported"),"C"==t[l]){c=(p-l-1)/6,console.assert(c==Math.floor(c));for(var i=0;i<c;i++)r=h.clone(),o=new THREE.Vector3(t[l+1],t[l+2],0),n=new THREE.Vector3(t[l+3],t[l+4],0),s=new THREE.Vector3(t[l+5],t[l+6],0),u=new THREE.CubicBezierCurve3(r,o,n,s),h=s.clone(),a.vertices=a.vertices.concat(u.getSpacedPoints(e.curveQuality)),l+=6}if("c"==t[l]){c=(p-l-1)/6,console.assert(c==Math.floor(c));for(var i=0;i<c;i++)r=h.clone(),o=new THREE.Vector3(t[l+1],t[l+2],0).add(h),n=new THREE.Vector3(t[l+3],t[l+4],0).add(h),s=new THREE.Vector3(t[l+5],t[l+6],0).add(h),u=new THREE.CubicBezierCurve3(r,o,n,s),h=s.clone(),a.vertices=a.vertices.concat(u.getSpacedPoints(e.curveQuality)),l+=6}if("S"!=t[l]&&"T"!=t[l]||console.error("SVG Simplified Beziers (S and T) commands are not currently supported"),"Q"==t[l]){c=(p-l-1)/4;for(var i=0;i<c;i++)u=new THREE.QuadraticBezierCurve3(h.clone(),new THREE.Vector3(t[l+1],t[l+2],0),new THREE.Vector3(t[l+3],t[l+4],0)),h=new THREE.Vector3(t[l+3],t[l+4],0),a.vertices=a.vertices.concat(u.getSpacedPoints(e.curveQuality)),l+=4}if("q"==t[l]){c=(p-l-1)/4;for(var i=0;i<c;i++){var r=h.clone(),s=new THREE.Vector3(t[l+1],t[l+2],0).add(r),v=new THREE.Vector3(t[l+3],t[l+4],0).add(s);h=v.clone(),u=new THREE.QuadraticBezierCurve3(r,s,v),a.vertices=a.vertices.concat(u.getSpacedPoints(e.curveQuality)),l+=4}}"Z"==t[l]&&a.vertices.push(a.vertices[0].clone())}return a}if("undefined"==typeof AFRAME)throw new Error("Component attempted to register before AFRAME was available.");i(1),AFRAME.registerComponent("meshline",{schema:{color:{default:"#000"},lineWidth:{default:10},lineWidthStyler:{default:"1"},path:{default:[{x:-.5,y:0,z:0},{x:.5,y:0,z:0}],parse:function(t){return t instanceof String?t.split(",").map(AFRAME.utils.coordinates.parse):t},stringify:function(t){return t.map(AFRAME.utils.coordinates.stringify).join(",")}},svg:{type:"string",default:""},curveQuality:{type:"number",default:20},texture:{type:"map",default:null},opacity:{type:"number",default:null}},init:function(){this.resolution=new THREE.Vector2(window.innerWidth,window.innerHeight);var t=this.el.sceneEl;t.addEventListener("render-target-loaded",this.do_update.bind(this)),t.addEventListener("render-target-loaded",this.addlisteners.bind(this)),this.strokeTexture=null},addlisteners:function(){window.addEventListener("resize",this.do_update.bind(this))},do_update:function(){var t=this.el.sceneEl.canvas;this.resolution.set(t.width,t.height),this.update()},update:function(t){var e,i=this.data;if(void 0===t&&(t={}),null!==this.data.texture&&null===this.strokeTexture){var o=new THREE.TextureLoader;return void o.load(this.data.texture,function(t){this.strokeTexture=t,this.update()}.bind(this))}var n=new THREE.MeshLineMaterial({color:new THREE.Color(this.data.color),resolution:this.resolution,sizeAttenuation:!1,lineWidth:i.lineWidth,useMap:null===this.strokeTexture?0:1,map:this.strokeTexture,side:THREE.DoubleSide,opacity:i.opacity?i.opacity:1,transparent:null!=i.opacity,depthTest:null==i.opacity}),a=new THREE.MeshBasicMaterial({wireframe:!0,color:"#ff0000"}),h=new THREE.Geometry;if(this.data.svg.length>0&&"svg"in AFRAME.utils.diff(i,t))h=s(r(i.svg.trim()),{curveQuality:i.curveQuality}),e=new THREE.MeshLine,e.setGeometry(h),this.el.setObject3D("mesh",new THREE.Mesh(e.geometry,a));else{this.data.path.forEach(function(t){h.vertices.push(new THREE.Vector3(t.x,t.y,t.z))});var u=new Function("p","return "+this.data.lineWidthStyler);e=new THREE.MeshLine,e.setGeometry(h,u),this.el.setObject3D("mesh",new THREE.Mesh(e.geometry,n))}},remove:function(){this.el.removeObject3D("mesh")}})},function(t,e){THREE.MeshLine=function(){this.positions=[],this.previous=[],this.next=[],this.side=[],this.width=[],this.indices_array=[],this.uvs=[],this.geometry=new THREE.BufferGeometry,this.widthCallback=null},THREE.MeshLine.prototype.setGeometry=function(t,e){if(this.widthCallback=e,this.positions=[],t instanceof THREE.Geometry)for(var i=0;i<t.vertices.length;i++){var r=t.vertices[i];this.positions.push(r.x,r.y,r.z),this.positions.push(r.x,r.y,r.z)}if(t instanceof THREE.BufferGeometry,t instanceof Float32Array||t instanceof Array)for(var i=0;i<t.length;i+=3)this.positions.push(t[i],t[i+1],t[i+2]),this.positions.push(t[i],t[i+1],t[i+2]);this.process()},THREE.MeshLine.prototype.compareV3=function(t,e){var i=6*t,r=6*e;return this.positions[i]===this.positions[r]&&this.positions[i+1]===this.positions[r+1]&&this.positions[i+2]===this.positions[r+2]},THREE.MeshLine.prototype.copyV3=function(t){var e=6*t;return[this.positions[e],this.positions[e+1],this.positions[e+2]]},THREE.MeshLine.prototype.process=function(){var t=this.positions.length/6;this.previous=[],this.next=[],this.side=[],this.width=[],this.indices_array=[],this.uvs=[];for(var e=0;e<t;e++)this.side.push(1),this.side.push(-1);for(var i,e=0;e<t;e++)i=this.widthCallback?this.widthCallback(e/(t-1)):1,this.width.push(i),this.width.push(i);for(var e=0;e<t;e++)this.uvs.push(e/(t-1),0),this.uvs.push(e/(t-1),1);var r;r=this.compareV3(0,t-1)?this.copyV3(t-2):this.copyV3(0),this.previous.push(r[0],r[1],r[2]),this.previous.push(r[0],r[1],r[2]);for(var e=0;e<t-1;e++)r=this.copyV3(e),this.previous.push(r[0],r[1],r[2]),this.previous.push(r[0],r[1],r[2]);for(var e=1;e<t;e++)r=this.copyV3(e),this.next.push(r[0],r[1],r[2]),this.next.push(r[0],r[1],r[2]);r=this.compareV3(t-1,0)?this.copyV3(1):this.copyV3(t-1),this.next.push(r[0],r[1],r[2]),this.next.push(r[0],r[1],r[2]);for(var e=0;e<t-1;e++){var s=2*e;this.indices_array.push(s,s+1,s+2),this.indices_array.push(s+2,s+1,s+3)}this.attributes?(this.attributes.position.copyArray(new Float32Array(this.positions)),this.attributes.position.needsUpdate=!0,this.attributes.previous.copyArray(new Float32Array(this.previous)),this.attributes.previous.needsUpdate=!0,this.attributes.next.copyArray(new Float32Array(this.next)),this.attributes.next.needsUpdate=!0,this.attributes.side.copyArray(new Float32Array(this.side)),this.attributes.side.needsUpdate=!0,this.attributes.width.copyArray(new Float32Array(this.width)),this.attributes.width.needsUpdate=!0,this.attributes.uv.copyArray(new Float32Array(this.uvs)),this.attributes.uv.needsUpdate=!0,this.attributes.index.copyArray(new Uint16Array(this.index)),this.attributes.index.needsUpdate=!0):this.attributes={position:new THREE.BufferAttribute(new Float32Array(this.positions),3),previous:new THREE.BufferAttribute(new Float32Array(this.previous),3),next:new THREE.BufferAttribute(new Float32Array(this.next),3),side:new THREE.BufferAttribute(new Float32Array(this.side),1),width:new THREE.BufferAttribute(new Float32Array(this.width),1),uv:new THREE.BufferAttribute(new Float32Array(this.uvs),2),index:new THREE.BufferAttribute(new Uint16Array(this.indices_array),1)},this.geometry.addAttribute("position",this.attributes.position),this.geometry.addAttribute("previous",this.attributes.previous),this.geometry.addAttribute("next",this.attributes.next),this.geometry.addAttribute("side",this.attributes.side),this.geometry.addAttribute("width",this.attributes.width),this.geometry.addAttribute("uv",this.attributes.uv),this.geometry.setIndex(this.attributes.index)},THREE.MeshLineMaterial=function(t){function e(t,e){return void 0===t?e:t}var i=["precision highp float;","","attribute vec3 position;","attribute vec3 previous;","attribute vec3 next;","attribute float side;","attribute float width;","attribute vec2 uv;","","uniform mat4 projectionMatrix;","uniform mat4 modelViewMatrix;","uniform vec2 resolution;","uniform float lineWidth;","uniform vec3 color;","uniform float opacity;","uniform float near;","uniform float far;","uniform float sizeAttenuation;","","varying vec2 vUV;","varying vec4 vColor;","","vec2 fix( vec4 i, float aspect ) {","","    vec2 res = i.xy / i.w;","    res.x *= aspect;","    return res;","","}","","void main() {","","    float aspect = resolution.x / resolution.y;","\t float pixelWidthRatio = 1. / (resolution.x * projectionMatrix[0][0]);","","    vColor = vec4( color, opacity );","    vUV = uv;","","    mat4 m = projectionMatrix * modelViewMatrix;","    vec4 finalPosition = m * vec4( position, 1.0 );","    vec4 prevPos = m * vec4( previous, 1.0 );","    vec4 nextPos = m * vec4( next, 1.0 );","","    vec2 currentP = fix( finalPosition, aspect );","    vec2 prevP = fix( prevPos, aspect );","    vec2 nextP = fix( nextPos, aspect );","","\t float pixelWidth = finalPosition.w * pixelWidthRatio;","    float w = 1.8 * pixelWidth * lineWidth * width;","","    if( sizeAttenuation == 1. ) {","        w = 1.8 * lineWidth * width;","    }","","    vec2 dir;","    if( nextP == currentP ) dir = normalize( currentP - prevP );","    else if( prevP == currentP ) dir = normalize( nextP - currentP );","    else {","        vec2 dir1 = normalize( currentP - prevP );","        vec2 dir2 = normalize( nextP - currentP );","        dir = normalize( dir1 + dir2 );","","        vec2 perp = vec2( -dir1.y, dir1.x );","        vec2 miter = vec2( -dir.y, dir.x );","        //w = clamp( w / dot( miter, perp ), 0., 4. * lineWidth * width );","","    }","","    //vec2 normal = ( cross( vec3( dir, 0. ), vec3( 0., 0., 1. ) ) ).xy;","    vec2 normal = vec2( -dir.y, dir.x );","    normal.x /= aspect;","    normal *= .5 * w;","","    vec4 offset = vec4( normal * side, 0.0, 1.0 );","    finalPosition.xy += offset.xy;","","    gl_Position = finalPosition;","","}"],r=["#extension GL_OES_standard_derivatives : enable","precision mediump float;","","uniform sampler2D map;","uniform float useMap;","uniform float useDash;","uniform vec2 dashArray;","","varying vec2 vUV;","varying vec4 vColor;","","void main() {","","    vec4 c = vColor;","    if( useMap == 1. ) c *= texture2D( map, vUV );","\t if( useDash == 1. ){","\t \t ","\t }","    gl_FragColor = c;","","}"];THREE.Material.call(this),t=t||{},this.lineWidth=e(t.lineWidth,1),this.map=e(t.map,null),this.useMap=e(t.useMap,0),this.color=e(t.color,new THREE.Color(16777215)),this.opacity=e(t.opacity,1),this.resolution=e(t.resolution,new THREE.Vector2(1,1)),this.sizeAttenuation=e(t.sizeAttenuation,1),this.near=e(t.near,1),this.far=e(t.far,1),this.dashArray=e(t.dashArray,[]),this.useDash=this.dashArray!==[]?1:0;var s=new THREE.RawShaderMaterial({uniforms:{lineWidth:{type:"f",value:this.lineWidth},map:{type:"t",value:this.map},useMap:{type:"f",value:this.useMap},color:{type:"c",value:this.color},opacity:{type:"f",value:this.opacity},resolution:{type:"v2",value:this.resolution},sizeAttenuation:{type:"f",value:this.sizeAttenuation},near:{type:"f",value:this.near},far:{type:"f",value:this.far},dashArray:{type:"v2",value:new THREE.Vector2(this.dashArray[0],this.dashArray[1])},useDash:{type:"f",value:this.useDash}},vertexShader:i.join("\r\n"),fragmentShader:r.join("\r\n")});return delete t.lineWidth,delete t.map,delete t.useMap,delete t.color,delete t.opacity,delete t.resolution,delete t.sizeAttenuation,delete t.near,delete t.far,delete t.dashArray,s.type="MeshLineMaterial",s.setValues(t),s},THREE.MeshLineMaterial.prototype=Object.create(THREE.Material.prototype),THREE.MeshLineMaterial.prototype.constructor=THREE.MeshLineMaterial,THREE.MeshLineMaterial.prototype.copy=function(t){return THREE.Material.prototype.copy.call(this,t),this.lineWidth=t.lineWidth,this.map=t.map,this.useMap=t.useMap,this.color.copy(t.color),this.opacity=t.opacity,this.resolution.copy(t.resolution),this.sizeAttenuation=t.sizeAttenuation,this.near=t.near,this.far=t.far,this}}]);